import numpy as np
from functools import reduce

data={"data":[{"_id":"600eb2fdc1e18e0008a45297","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":1114.65,"CH_TRADE_LOW_PRICE":1017,"CH_OPENING_PRICE":1025,"CH_CLOSING_PRICE":1069.75,"CH_LAST_TRADED_PRICE":1062.9,"CH_PREVIOUS_CLS_PRICE":1004,"CH_TOT_TRADED_QTY":15344078,"CH_TOT_TRADED_VAL":16495788061.85,"CH_52WEEK_HIGH_PRICE":1114.65,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":316677,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-25","TIMESTAMP":"2021-01-24T18:30:00.000Z","createdAt":"2021-01-25T12:01:01.914Z","updatedAt":"2021-01-25T12:01:01.914Z","__v":0,"VWAP":1075.06,"mTIMESTAMP":"25-Jan-2021"},{"_id":"600abe628a4b290008ee1b33","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":1030.75,"CH_TRADE_LOW_PRICE":1000,"CH_OPENING_PRICE":1022.3,"CH_CLOSING_PRICE":1004,"CH_LAST_TRADED_PRICE":1001.25,"CH_PREVIOUS_CLS_PRICE":1017.1,"CH_TOT_TRADED_QTY":1029795,"CH_TOT_TRADED_VAL":1042930232.35,"CH_52WEEK_HIGH_PRICE":1052.5,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":31591,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-22","TIMESTAMP":"2021-01-21T18:30:00.000Z","createdAt":"2021-01-22T12:00:34.623Z","updatedAt":"2021-01-22T12:00:34.623Z","__v":0,"VWAP":1012.76,"mTIMESTAMP":"22-Jan-2021"},{"_id":"60096cdb741e2900081a1658","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":1046.95,"CH_TRADE_LOW_PRICE":1012.5,"CH_OPENING_PRICE":1036,"CH_CLOSING_PRICE":1017.1,"CH_LAST_TRADED_PRICE":1022.3,"CH_PREVIOUS_CLS_PRICE":1034.7,"CH_TOT_TRADED_QTY":1268212,"CH_TOT_TRADED_VAL":1307712836.4,"CH_52WEEK_HIGH_PRICE":1052.5,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":36055,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-21","TIMESTAMP":"2021-01-20T18:30:00.000Z","createdAt":"2021-01-21T12:00:27.624Z","updatedAt":"2021-01-21T12:00:27.624Z","__v":0,"VWAP":1031.15,"mTIMESTAMP":"21-Jan-2021"},{"_id":"60081b7d2c04b60008834aee","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":1038.5,"CH_TRADE_LOW_PRICE":1014.8,"CH_OPENING_PRICE":1028,"CH_CLOSING_PRICE":1034.7,"CH_LAST_TRADED_PRICE":1028.9,"CH_PREVIOUS_CLS_PRICE":1031.9,"CH_TOT_TRADED_QTY":1528763,"CH_TOT_TRADED_VAL":1567672407.5,"CH_52WEEK_HIGH_PRICE":1052.5,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":52762,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-20","TIMESTAMP":"2021-01-19T18:30:00.000Z","createdAt":"2021-01-20T12:01:01.671Z","updatedAt":"2021-01-20T12:01:01.671Z","__v":0,"VWAP":1025.45,"mTIMESTAMP":"20-Jan-2021"},{"_id":"6006c9e3f10a0d00083c4f66","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":1052.5,"CH_TRADE_LOW_PRICE":1002,"CH_OPENING_PRICE":1002,"CH_CLOSING_PRICE":1031.9,"CH_LAST_TRADED_PRICE":1032,"CH_PREVIOUS_CLS_PRICE":999.2,"CH_TOT_TRADED_QTY":4059040,"CH_TOT_TRADED_VAL":4211452529.5,"CH_52WEEK_HIGH_PRICE":1052.5,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":98799,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-19","TIMESTAMP":"2021-01-18T18:30:00.000Z","createdAt":"2021-01-19T12:00:35.127Z","updatedAt":"2021-01-19T12:00:35.127Z","__v":0,"VWAP":1037.55,"mTIMESTAMP":"19-Jan-2021"},{"_id":"6005787e2e3c9a000810ec3b","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":1029.55,"CH_TRADE_LOW_PRICE":990.85,"CH_OPENING_PRICE":1023,"CH_CLOSING_PRICE":999.2,"CH_LAST_TRADED_PRICE":994.85,"CH_PREVIOUS_CLS_PRICE":1033.05,"CH_TOT_TRADED_QTY":1847393,"CH_TOT_TRADED_VAL":1860441935.2,"CH_52WEEK_HIGH_PRICE":1041,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":56469,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-18","TIMESTAMP":"2021-01-17T18:30:00.000Z","createdAt":"2021-01-18T12:01:02.423Z","updatedAt":"2021-01-18T12:01:02.423Z","__v":0,"VWAP":1007.06,"mTIMESTAMP":"18-Jan-2021"},{"_id":"600183fd5a01880008107397","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":1039.3,"CH_TRADE_LOW_PRICE":1001.6,"CH_OPENING_PRICE":1015.1,"CH_CLOSING_PRICE":1033.05,"CH_LAST_TRADED_PRICE":1033.7,"CH_PREVIOUS_CLS_PRICE":1020.25,"CH_TOT_TRADED_QTY":2026203,"CH_TOT_TRADED_VAL":2065405038.65,"CH_52WEEK_HIGH_PRICE":1041,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":47048,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-15","TIMESTAMP":"2021-01-14T18:30:00.000Z","createdAt":"2021-01-15T12:01:01.800Z","updatedAt":"2021-01-15T12:01:01.800Z","__v":0,"VWAP":1019.35,"mTIMESTAMP":"15-Jan-2021"},{"_id":"6000327e6e104f0008e68eaf","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":1040.95,"CH_TRADE_LOW_PRICE":1013.3,"CH_OPENING_PRICE":1035,"CH_CLOSING_PRICE":1020.25,"CH_LAST_TRADED_PRICE":1015.1,"CH_PREVIOUS_CLS_PRICE":1033.35,"CH_TOT_TRADED_QTY":1522045,"CH_TOT_TRADED_VAL":1557445602.6,"CH_52WEEK_HIGH_PRICE":1041,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":41926,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-14","TIMESTAMP":"2021-01-13T18:30:00.000Z","createdAt":"2021-01-14T12:01:02.321Z","updatedAt":"2021-01-14T12:01:02.321Z","__v":0,"VWAP":1023.26,"mTIMESTAMP":"14-Jan-2021"},{"_id":"5ffee0dbc4dee300088dd5da","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":1041,"CH_TRADE_LOW_PRICE":1007.45,"CH_OPENING_PRICE":1009,"CH_CLOSING_PRICE":1033.35,"CH_LAST_TRADED_PRICE":1031.8,"CH_PREVIOUS_CLS_PRICE":1010.3,"CH_TOT_TRADED_QTY":2205417,"CH_TOT_TRADED_VAL":2257344453.3,"CH_52WEEK_HIGH_PRICE":1041,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":42509,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-13","TIMESTAMP":"2021-01-12T18:30:00.000Z","createdAt":"2021-01-13T12:00:27.702Z","updatedAt":"2021-01-13T12:00:27.702Z","__v":0,"VWAP":1023.55,"mTIMESTAMP":"13-Jan-2021"},{"_id":"5ffd8f7e5a01880008024c85","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":1020.6,"CH_TRADE_LOW_PRICE":997.7,"CH_OPENING_PRICE":1005.8,"CH_CLOSING_PRICE":1010.3,"CH_LAST_TRADED_PRICE":1010.2,"CH_PREVIOUS_CLS_PRICE":1004.3,"CH_TOT_TRADED_QTY":1551157,"CH_TOT_TRADED_VAL":1568640277.5,"CH_52WEEK_HIGH_PRICE":1023.85,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":37380,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-12","TIMESTAMP":"2021-01-11T18:30:00.000Z","createdAt":"2021-01-12T12:01:02.273Z","updatedAt":"2021-01-12T12:01:02.273Z","__v":0,"VWAP":1011.27,"mTIMESTAMP":"12-Jan-2021"},{"_id":"5ffc3dfe7ddd690008b04ace","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":1012.3,"CH_TRADE_LOW_PRICE":994.45,"CH_OPENING_PRICE":999.35,"CH_CLOSING_PRICE":1004.3,"CH_LAST_TRADED_PRICE":1003.05,"CH_PREVIOUS_CLS_PRICE":1004.3,"CH_TOT_TRADED_QTY":1249633,"CH_TOT_TRADED_VAL":1255411930.15,"CH_52WEEK_HIGH_PRICE":1023.85,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":39738,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-11","TIMESTAMP":"2021-01-10T18:30:00.000Z","createdAt":"2021-01-11T12:01:02.697Z","updatedAt":"2021-01-11T12:01:02.697Z","__v":0,"VWAP":1004.62,"mTIMESTAMP":"11-Jan-2021"},{"_id":"5ff8496065de43000897d02c","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":1023.85,"CH_TRADE_LOW_PRICE":992.1,"CH_OPENING_PRICE":999.65,"CH_CLOSING_PRICE":1004.3,"CH_LAST_TRADED_PRICE":1000.65,"CH_PREVIOUS_CLS_PRICE":993.85,"CH_TOT_TRADED_QTY":2381402,"CH_TOT_TRADED_VAL":2403369142.4,"CH_52WEEK_HIGH_PRICE":1023.85,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":44294,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-08","TIMESTAMP":"2021-01-07T18:30:00.000Z","createdAt":"2021-01-08T12:00:32.706Z","updatedAt":"2021-01-08T12:00:32.706Z","__v":0,"VWAP":1009.22,"mTIMESTAMP":"08-Jan-2021"},{"_id":"5ff6f7e1345f1a00088765f6","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":1004.65,"CH_TRADE_LOW_PRICE":977.2,"CH_OPENING_PRICE":990,"CH_CLOSING_PRICE":993.85,"CH_LAST_TRADED_PRICE":991.95,"CH_PREVIOUS_CLS_PRICE":984.6,"CH_TOT_TRADED_QTY":1888940,"CH_TOT_TRADED_VAL":1874322269.95,"CH_52WEEK_HIGH_PRICE":1004.65,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":46601,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-07","TIMESTAMP":"2021-01-06T18:30:00.000Z","createdAt":"2021-01-07T12:00:33.384Z","updatedAt":"2021-01-07T12:00:33.384Z","__v":0,"VWAP":992.26,"mTIMESTAMP":"07-Jan-2021"},{"_id":"5ff5a67e65de43000895f4be","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":989.5,"CH_TRADE_LOW_PRICE":955.05,"CH_OPENING_PRICE":960,"CH_CLOSING_PRICE":984.6,"CH_LAST_TRADED_PRICE":985.85,"CH_PREVIOUS_CLS_PRICE":961.3,"CH_TOT_TRADED_QTY":2162883,"CH_TOT_TRADED_VAL":2104866944.85,"CH_52WEEK_HIGH_PRICE":989.5,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":46754,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-06","TIMESTAMP":"2021-01-05T18:30:00.000Z","createdAt":"2021-01-06T12:01:02.207Z","updatedAt":"2021-01-06T12:01:02.207Z","__v":0,"VWAP":973.18,"mTIMESTAMP":"06-Jan-2021"},{"_id":"5ff45fc6345f1a0008859376","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":971.95,"CH_TRADE_LOW_PRICE":946.95,"CH_OPENING_PRICE":955,"CH_CLOSING_PRICE":961.3,"CH_LAST_TRADED_PRICE":960.5,"CH_PREVIOUS_CLS_PRICE":964.45,"CH_TOT_TRADED_QTY":1511818,"CH_TOT_TRADED_VAL":1450137609.85,"CH_52WEEK_HIGH_PRICE":971.95,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":33765,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-05","TIMESTAMP":"2021-01-04T18:30:00.000Z","createdAt":"2021-01-05T12:47:02.058Z","updatedAt":"2021-01-05T12:47:02.058Z","__v":0,"VWAP":959.2,"mTIMESTAMP":"05-Jan-2021"},{"_id":"5ff328fe2802680008931e0c","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":967,"CH_TRADE_LOW_PRICE":937.15,"CH_OPENING_PRICE":937.15,"CH_CLOSING_PRICE":964.45,"CH_LAST_TRADED_PRICE":963,"CH_PREVIOUS_CLS_PRICE":933.4,"CH_TOT_TRADED_QTY":2667535,"CH_TOT_TRADED_VAL":2544309973.5,"CH_52WEEK_HIGH_PRICE":967,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":48114,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-04","TIMESTAMP":"2021-01-03T18:30:00.000Z","createdAt":"2021-01-04T14:41:02.133Z","updatedAt":"2021-01-04T14:41:02.133Z","__v":0,"VWAP":953.81,"mTIMESTAMP":"04-Jan-2021"},{"_id":"5fef0ee265de430008932ea7","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":938,"CH_TRADE_LOW_PRICE":920.25,"CH_OPENING_PRICE":924.5,"CH_CLOSING_PRICE":933.4,"CH_LAST_TRADED_PRICE":932.95,"CH_PREVIOUS_CLS_PRICE":927.85,"CH_TOT_TRADED_QTY":1151605,"CH_TOT_TRADED_VAL":1070616883.3,"CH_52WEEK_HIGH_PRICE":954,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":23247,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2021-01-01","TIMESTAMP":"2020-12-31T18:30:00.000Z","createdAt":"2021-01-01T12:00:34.536Z","updatedAt":"2021-01-01T12:00:34.536Z","__v":0,"VWAP":929.67,"mTIMESTAMP":"01-Jan-2021"},{"_id":"5fedbd7e65de4300089231ff","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":940.85,"CH_TRADE_LOW_PRICE":921.55,"CH_OPENING_PRICE":939.8,"CH_CLOSING_PRICE":927.85,"CH_LAST_TRADED_PRICE":923.5,"CH_PREVIOUS_CLS_PRICE":934.4,"CH_TOT_TRADED_QTY":2077998,"CH_TOT_TRADED_VAL":1929632828.85,"CH_52WEEK_HIGH_PRICE":954,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":38683,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2020-12-31","TIMESTAMP":"2020-12-30T18:30:00.000Z","createdAt":"2020-12-31T12:01:02.104Z","updatedAt":"2020-12-31T12:01:02.104Z","__v":0,"VWAP":928.6,"mTIMESTAMP":"31-Dec-2020"},{"_id":"5fec6bfd65de430008914e24","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":938.95,"CH_TRADE_LOW_PRICE":897.3,"CH_OPENING_PRICE":911.1,"CH_CLOSING_PRICE":934.4,"CH_LAST_TRADED_PRICE":937.1,"CH_PREVIOUS_CLS_PRICE":909.5,"CH_TOT_TRADED_QTY":2280218,"CH_TOT_TRADED_VAL":2097093704.35,"CH_52WEEK_HIGH_PRICE":954,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":45659,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2020-12-30","TIMESTAMP":"2020-12-29T18:30:00.000Z","createdAt":"2020-12-30T12:01:01.800Z","updatedAt":"2020-12-30T12:01:01.800Z","__v":0,"VWAP":919.69,"mTIMESTAMP":"30-Dec-2020"},{"_id":"5feb1a5b0569620008e045bd","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":922.65,"CH_TRADE_LOW_PRICE":906.2,"CH_OPENING_PRICE":911,"CH_CLOSING_PRICE":909.5,"CH_LAST_TRADED_PRICE":907.35,"CH_PREVIOUS_CLS_PRICE":906.65,"CH_TOT_TRADED_QTY":1624766,"CH_TOT_TRADED_VAL":1484454942.3,"CH_52WEEK_HIGH_PRICE":954,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":32666,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2020-12-29","TIMESTAMP":"2020-12-28T18:30:00.000Z","createdAt":"2020-12-29T12:00:27.292Z","updatedAt":"2020-12-29T12:00:27.292Z","__v":0,"VWAP":913.64,"mTIMESTAMP":"29-Dec-2020"},{"_id":"5fe9c8e2c94f580008f4f2df","CH_SYMBOL":"GRASIM","CH_SERIES":"EQ","CH_MARKET_TYPE":"N","CH_TRADE_HIGH_PRICE":912.35,"CH_TRADE_LOW_PRICE":897.1,"CH_OPENING_PRICE":901.2,"CH_CLOSING_PRICE":906.65,"CH_LAST_TRADED_PRICE":910,"CH_PREVIOUS_CLS_PRICE":897.15,"CH_TOT_TRADED_QTY":1489896,"CH_TOT_TRADED_VAL":1348656606.5,"CH_52WEEK_HIGH_PRICE":954,"CH_52WEEK_LOW_PRICE":385.05,"CH_TOTAL_TRADES":22222,"CH_ISIN":"INE047A01021","CH_TIMESTAMP":"2020-12-28","TIMESTAMP":"2020-12-27T18:30:00.000Z","createdAt":"2020-12-28T12:00:34.935Z","updatedAt":"2020-12-28T12:00:34.935Z","__v":0,"VWAP":905.2,"mTIMESTAMP":"28-Dec-2020"}],"meta":{"series":["EQ"],"fromDate":"27-12-2020","toDate":"27-01-2021","symbols":["GRASIM","GRASIM"]}}
stockData = {"info":{"symbol":"GRASIM","companyName":"Grasim Industries Limited","industry":"CEMENT AND CEMENT PRODUCTS","activeSeries":["EQ"],"debtSeries":[],"tempSuspendedSeries":["IL"],"isFNOSec":"true","isCASec":"false","isSLBSec":"true","isDebtSec":"false","isSuspended":"false","isETFSec":"false","isDelisted":"false","isin":"INE047A01021","isTop10":"true","identifier":"GRASIMEQN"},"metadata":{"series":"EQ","symbol":"GRASIM","isin":"INE047A01021","status":"Listed","listingDate":"10-May-1995","industry":"CEMENT","lastUpdateTime":"25-Jan-2021 16:00:00","pdSectorPe":44.18,"pdSymbolPe":0,"pdSectorInd":"NIFTY 500                                         "},"securityInfo":{"boardStatus":"Main","tradingStatus":"Active","tradingSegment":"Normal Market","sessionNo":"-","slb":"Yes","classOfShare":"Equity","derivatives":"Yes","surveillance":"-","faceValue":2,"issuedCap":657951004},"priceInfo":{"lastPrice":1062.9,"change":58.90000000000009,"pChange":5.866533864541842,"previousClose":1004,"open":1025,"close":1069.75,"vwap":1075.05,"lowerCP":"903.60","upperCP":"1104.40","pPriceBand":"No Band","basePrice":1004,"intraDayHighLow":{"min":1017,"max":1114.65,"value":1062.9},"weekHighLow":{"min":385.05,"minDate":"25-Mar-2020","max":1114.65,"maxDate":"25-Jan-2021","value":1062.9}},"preOpenMarket":{"preopen":[{"price":903.6,"buyQty":0,"sellQty":175},{"price":933.7,"buyQty":0,"sellQty":52},{"price":953.8,"buyQty":0,"sellQty":52},{"price":975,"buyQty":0,"sellQty":550},{"price":1025,"buyQty":0,"sellQty":0,"iep":"true"},{"price":1078,"buyQty":1,"sellQty":0},{"price":1098,"buyQty":200,"sellQty":0},{"price":1100,"buyQty":652,"sellQty":0},{"price":1104,"buyQty":40,"sellQty":0}],"ato":{"buy":8291,"sell":63},"IEP":1025,"totalTradedVolume":29208,"finalPrice":1025,"finalQuantity":29408,"lastUpdateTime":"25-Jan-2021 09:07:44","totalBuyQuantity":28619,"totalSellQuantity":10033,"atoBuyQty":8291,"atoSellQty":63}}

class NseProcessor:
    def __init__(self):
        pass

    def process_stock(self, data):

        STOCK_STATUS = {"today_change":"", "sudden_variation": "",
                        "breaking_price_high":"" , "volume_breakout": 0}
        stockDataList = data["data"]
        if len(stockDataList) <= 5:
            print("StockDataList is blank")
            return STOCK_STATUS
        stockVolumeList = []
        stockClosePriceList = []
        stockHighLowVariationList = []
        nowData = stockDataList[0]
        currentPrice = nowData["CH_CLOSING_PRICE"]
        fiftyTwoWeekHighPrice = nowData["CH_52WEEK_HIGH_PRICE"]
        if nowData["CH_PREVIOUS_CLS_PRICE"] > nowData["CH_CLOSING_PRICE"]:
            STOCK_STATUS["today_change"] = "DOWN"
            print("Stock is down today")
        else:
            STOCK_STATUS["today_change"] = "UP"
            print("Stock is up today")

        threePercentOfCurrentPrice = currentPrice * 0.03
        print(stockDataList)
        print(len(stockDataList))
        prevData = stockDataList[1]
        for stockData in stockDataList:
            stockVolumeList.append(stockData["CH_TOT_TRADED_QTY"])
            stockClosePriceList.append(stockData["CH_CLOSING_PRICE"])
            stockDayVariation = ((stockData["CH_TRADE_HIGH_PRICE"] - stockData["CH_TRADE_LOW_PRICE"]) / stockData[
                "CH_TRADE_LOW_PRICE"]) * 100
            stockHighLowVariationList.append(stockDayVariation)

        # Stock Variation is Stock High Price divided by Stock Low price
        # on that day divided by Stock Low Price
        # It calcualtes percentage variation
        # Create Stock Average Variation and then Divide Today's Stock Variation with Avg Stock Variation
        # if it is greater than 2 then there is something wrong
        avgStockVariation = reduce(lambda a, b: a + b, stockHighLowVariationList) / len(stockHighLowVariationList)
        todaysStockVariation = ((nowData["CH_TRADE_HIGH_PRICE"] - nowData["CH_TRADE_LOW_PRICE"]) / nowData[
            "CH_TRADE_LOW_PRICE"]) * 100
        variationInStockPrice = todaysStockVariation / avgStockVariation
        if variationInStockPrice > 2:
            STOCK_STATUS["sudden_variation"] = variationInStockPrice

            print("Today's variation is more .. something going on with this stock")
        avgVolume = reduce(lambda a, b: a + b, stockVolumeList[1:5]) / 4


        print(stockVolumeList[1:5])
        print(nowData["CH_TOT_TRADED_QTY"])
        print(prevData["CH_TOT_TRADED_QTY"])
        increaseInVolume = nowData["CH_TOT_TRADED_QTY"] / prevData["CH_TOT_TRADED_QTY"];
        print("Increase in Volume")
        print(increaseInVolume)
        if increaseInVolume > 3:
            print("There is a breakout")
            STOCK_STATUS["volume_breakout"] = str(increaseInVolume)
            print("Breakout intensity is " + str(increaseInVolume))
        print(avgVolume)

        stockClosePriceSortedList = np.sort(stockClosePriceList)
        # Check if the price is breaking 52 week high or previous high
        if fiftyTwoWeekHighPrice < currentPrice:
            STOCK_STATUS["breaking_price_high"] = "52High"
        elif fiftyTwoWeekHighPrice < (currentPrice + threePercentOfCurrentPrice):
            STOCK_STATUS["breaking_price_high"] = "52Minus3"
            print("breaking the 52 week high")

        if stockClosePriceList[-1] < currentPrice:
            print("already broken the current high")
            STOCK_STATUS["breaking_price_high"] = "CurrentHigh"
        elif stockClosePriceList[-1] < (currentPrice + threePercentOfCurrentPrice):
            print("Trying to break 3month or 6month high")
            STOCK_STATUS["breaking_price_high"] = "CurrentHighMinus3"

        print(stockClosePriceSortedList)
        print(stockClosePriceSortedList[-1])
        print(stockClosePriceSortedList[0])
        print(stockData.keys())
        return STOCK_STATUS



